import java.util.*;

public class Partie {
	private static Partie partie = null;
	private ArrayList<Joueur> joueurs;
	private int nbJoueur;
	private int nbJoueurVirtuel;
	//private Tas tas;
	//Private Pioche pioche;

	private Partie() {
		this.joueurs = new ArrayList<Joueur>();
		this.nbJoueur = 3;
		this.nbJoueurVirtuel = 1;
		//this.tas = new Tas();
		//this.pioche = new Pioche();
	}

	public static Partie getInstance() {
		if (partie == null) {
			partie = new Partie();
		}
		return partie;
	}

	public void addJoueur(Joueur joueur) {
		this.joueurs.add(joueur);
	}

	public ArrayList<Joueur> getJoueurs() {
		return this.joueurs;
	}

	public void configurerNbJoueur(Scanner sc) {
		System.out.println("\n Combien de joueurs souhaitez vous (entre 3 et 4)?\n ");

		String choix = "0";
		boolean valide = false;
		while (valide == false) {

			choix = sc.nextLine();

			switch (choix) {
			case "3":
				this.nbJoueur = 3;
				valide = true;
				break;
			case "4":
				this.nbJoueur = 4;
				valide = true;

				break;
			default:
				System.out.println("Vous avez tapé un mauvais nombre, veuillez recommencer");

			}
		}

	}

	public void configurerNbJoueurVirtuel(Scanner sc) {
		System.out.println("\n Combien de joueurs virtuels souhaitez vous (inférieur à " + this.nbJoueur + ")?");

		String choix = "0";
		boolean valide = false;
		while (valide == false) {

			choix = sc.nextLine();

			switch (choix) {
			case "0":
				this.nbJoueurVirtuel = 0;
				valide = true;
				break;
			case "1":
				this.nbJoueurVirtuel = 1;
				valide = true;
				break;
			case "2":
				this.nbJoueurVirtuel = 2;
				valide = true;
				break;
			case "3":
				if (this.nbJoueur == 4) {
					this.nbJoueurVirtuel = 3;
					valide = true;
					break;
				} else {
					System.out.println("Vous avez tapé un mauvais nombre, veuillez recommencer");

				}
			default:
				System.out.println("Vous avez tapé un mauvais nombre, veuillez recommencer");

			}
		}

		
	}

	public void configurerPartie(Scanner sc) {
		System.out.println("------Jeu De Jest------ \n");
		System.out.println("Que souhaitez vous faire? \n 1. Lancer une partie \n 2. Gérer les paramètres \n");
		String choix1 = "0";
		boolean valide = false;
		while (valide == false) {

			choix1 = sc.nextLine();

			switch (choix1) {
			case "1":
				valide = true;
				break;
			case "2":
				partie.configurerNbJoueur(sc);
				partie.configurerNbJoueurVirtuel(sc);
				valide = true;

				break;
			default:
				System.out.println("Vous avez tapé un mauvais nombre, veuillez recommencer");

			}
		}

	}

	public void initialisationPartie(Scanner sc) {// creer les joueurs avec leur pseudo, choisi les trophees de la partie
		int i;
		String pseudo = "0";
		for (i = 0; i < (nbJoueur - nbJoueurVirtuel); i++) {
			System.out.println("Choisir un pseudo pour le joueur" + (i + 1));
			pseudo = sc.nextLine();
			new JoueurReel(pseudo, this);
		}
		while (i < nbJoueur) {
			new JoueurVirtuel(this);
			i++;
		}
		/*this.pioche.melanger();
		this.trophee1 = new Trophee(this.pioche.retirerCarteDuHaut());
		if (nbJoueur == 3) {
			this.trophee2 = new Trophee(this.pioche.retirerCarteDuHaut());
		}*/
	}

	
	public static void main(String[] args) {
		Scanner sc = new Scanner(System.in);
		Partie.getInstance();
		partie.configurerPartie(sc);
		partie.initialisationPartie(sc);
		Iterator<Joueur> it = partie.joueurs.iterator();
		
		sc.close();
		
		Pioche pioche;
		Arbitre arbitre;
		Trophee trophee1;
		Trophee trophee2;
		ArrayList<Joueur> joueurs;
		LinkedList<Joueur> classementFinal;
		StrategieA strategieA;
		
		joueurs = partie.getJoueurs();
		arbitre = new Arbitre();
		pioche = new Pioche();
		pioche.melanger();
		trophee1 = new Trophee(pioche.retirerCarteDuHaut());
		trophee2 = new Trophee(pioche.retirerCarteDuHaut());
		strategieA = new StrategieA();
		
		/*Plan d'un tour de jeu: 
		 * Tant que pioche non vide(et que tout le monde peut piocher)
		 	* Chaque joueur: Pioche 2 cartes dans le tas + fait offre (dans l'ordre de meilleur jest)
		 	* Chaque joueur: Pioche dans offre d'un autre joueur si piochable + ajoute à son Jest
		 	* 	--> Joueur dont on vient de piocher la carte
		 	* 	--> Si dernier joueur: peut piocher dans sa propre offre
		 	* On remet les cartes restantes dans le tas à distribuer + on y ajoute autant de cartes de la ioche qu'il y a de joueurs
		 	* On distribue deux cartes du tas ainsi obtenu
		 * Quand pioche vide:
		 * Joueurs piochent carte restante dans leur Jest
		 * Attribution trophées
		 * Désignation du vainqueur
		 */
		
		//Premier tour de jeu différent des autres puisqu'on part uniquement de la pioche donc on va l'initialiser en dehors du while
		//On distribue donc deux cartes de la pioche aux joueurs
		for (Joueur j : joueurs){
			j.jest.ajouterCarte(pioche.retirerCarteDuHaut());
			j.jest.ajouterCarte(pioche.retirerCarteDuHaut());
		}
		//La fonction etablirClassement n'étant pas au point, on ne va pas encore faire la règle comme quoi le joueur avec le plus grand jest commence à piocher
		while (pioche.geta0Carte() == false){
			//Chacun fait son offre, dans l'ordre d'inscription des joueurs
			for (Joueur j : joueurs){
				if (j instanceof JoueurReel){
					boolean carteGauche = false;
					String carteVisible;
					System.out.println("Quelle carte souhaitez-vous rendre visible ? Gauche : 1 Droite: 2   ");
					Scanner carteV = new Scanner(System.in);
					carteVisible = carteV.nextLine();
					if (carteVisible  == "1"){
						carteGauche = true;
					}
					j.faireOffre(carteGauche);
					carteV.close();
				}
				else if (j instanceof JoueurVirtuel){
					j.faireOffre(strategieA);
				}
			}
			//On pioche ensuite dans les autre offre
			int nbJoueurs = joueurs.size();
			int compte = 0;
			Joueur j;
			
			joueurs.get(1).piocherOffre(a, carteVisible);
			while (compte < nbJoueurs){
				if (j instanceof JoueurReel){
					String reponseString = "O";
					while (reponseString == "O"){
						System.out.println("Voulez-vous consulter une offre ? Oui : O, Non: N ");
						Scanner reponse = new Scanner(System.in);
						reponseString = reponse.nextLine();
						if (reponseString == "O"){
							System.out.println("De quel joueur voulez-vous consulter l'offre ? ");
							reponse = new Scanner(System.in);
							String reponseStringJoueur = reponse.nextLine();
							j.consulterOffre(joueurs.get(Integer.parseInt(reponseStringJoueur)));
						}
					}
					
					System.out.println("");
					Scanner joueurAvoler = new Scanner(System.in);
					
					Scanner carteApiocher = new Scanner(System.in);
					
					
					carteApiocher.close();
				}
				else if (j instanceof JoueurVirtuel){
					
				}
			}
		}
		
		boolean carteRestanteGauche = false;
		//Quand pioche vide
		for (Joueur j : joueurs){
			//carteRestante correspond à la carte non piochée par un joueur adverse
			j.piocherOffre(j, carteRestanteGauche); //on va initialiser carteRestante tout au long des tours de jeu quand pioche != vide mais elle ne servira que pour cette partie
		}
		
		//Début de la définition des vainqueurs:
		arbitre.attribuerTrophee(joueurs, trophee1, trophee2);
		classementFinal = arbitre.etablirClassement(joueurs);
		
		System.out.println("Le gagnant est : " + classementFinal.get(1) + "\n Félicitations !");
		
	}

}
